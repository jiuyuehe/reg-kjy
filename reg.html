<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>科技云注册</title>

    <link rel="stylesheet" href="//cdn.bootcss.com/weui/1.1.1/style/weui.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/jquery-weui/1.0.1/css/jquery-weui.min.css">
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <style>
        .label-icon {
            text-align: center;
            color: #5398ff;
        }

        .weui-label {
            width: 40px;
        }

        ::-webkit-input-placeholder { /* WebKit browsers */
            color: lightgray;
        }

        :-moz-placeholder { /* Mozilla Firefox 4 to 18 */
            color: lightgray;
        }

        ::-moz-placeholder { /* Mozilla Firefox 19+ */
            color: lightgray;
        }

        :-ms-input-placeholder { /* Internet Explorer 10+ */
            color: lightgray;
        }

        .weui-cells_checkbox .weui-check:checked + .weui-icon-checked:before {
            color: #5398ff;
        }

        .weui-vcode-btn {
            color: #5398ff;
        }


    </style>
</head>
<body style="background-color: #f1f1f1;padding: 30px 8px">


<div class="weui-cells weui-cells_form">

    <div class="weui-cell reg_name_item">
        <div class="weui-cell__hd">
            <label class="weui-label label-icon">
                <i class="fa fa-user " aria-hidden="true"></i>
            </label>
        </div>
        <div class="weui-cell__bd">
            <input class="weui-input" id="reg_name" onblur="chkName()" maxlength="32" type="text" placeholder="请输入用户名">
        </div>

        <div class="weui-cell__ft">
            <i class="weui-icon-warn"></i>
        </div>
    </div>


    <div class="weui-cell">
        <div class="weui-cell__hd">
            <label class="weui-label  label-icon">

                <i class="fa fa-id-card " style="font-size: small" aria-hidden="true"></i>

            </label>
        </div>
        <div class="weui-cell__bd">
            <input class="weui-input" type="text" id="reg_home_id" placeholder="请输入单位代码">
        </div>

        <div class="weui-cell__ft">
            <button onclick="getEntName()" class="weui-vcode-btn">显示单位名称</button>
        </div>
    </div>





    <div class="weui-cell tel_item">
        <div class="weui-cell__hd">
            <label class="weui-label label-icon">
                <i class="fa fa-mobile-phone " style="font-size: x-large" aria-hidden="true"></i>
            </label>
        </div>
        <div class="weui-cell__bd">
            <input class="weui-input" id="reg_phone" type="number" pattern="[0-9]*" maxlength="11" placeholder="请输入手机号">
        </div>

        <div class="weui-cell__ft">
            <i class="weui-icon-warn"></i>
        </div>
    </div>

    <div class="weui-cell weui-cell_vcode">
        <div class="weui-cell__hd">
            <label class="weui-label label-icon">
                <i class="fa fa-code " aria-hidden="true"></i>
            </label>
        </div>
        <div class="weui-cell__bd">
            <input class="weui-input" id="reg_code" type="text" maxlength="4" placeholder="请输入验证码">
        </div>
        <div class="weui-cell__ft">
            <button onclick="getCkCode()" class="weui-vcode-btn">获取验证码</button>
        </div>
    </div>

    <div class="weui-cell pwd_item">
        <div class="weui-cell__hd">
            <label class="weui-label label-icon">
                <i class="fa fa-eye-slash " aria-hidden="true"></i>
            </label>
        </div>
        <div class="weui-cell__bd">
            <input class="weui-input" id="reg_pwd" type="password" placeholder="请输入密码">
        </div>

        <div class="weui-cell__ft">
            <i class="weui-icon-warn"></i>
        </div>

    </div>

    <div class="weui-cell reg_pwd_r_item ">
        <div class="weui-cell__hd">
            <label class="weui-label label-icon">
                <i class="fa fa-eye-slash " aria-hidden="true"></i>
            </label>
        </div>
        <div class="weui-cell__bd">
            <input class="weui-input" type="password" onblur="chkpwd()" id="reg_pwd_r" placeholder="再次输入密码">
        </div>
        <div class="weui-cell__ft">
            <i class="weui-icon-warn"></i>
        </div>
    </div>


</div>


<div class="weui-cells weui-cells_checkbox">
    <label class="weui-cell weui-check__label" for="reg_agree">
        <div class="weui-cell__hd">
            <input type="checkbox" class="weui-check" name="checkbox1" id="reg_agree" checked="checked">
            <i class="weui-icon-checked" style="color:#5398ff "></i>
        </div>
        <div class="weui-cell__bd">
            <p> 同意用户需知，隐私权限相关政策</p>
        </div>
    </label>
</div>

<a href="javascript:onClick();" style="margin-top: 30px;background-color:#5398ff " class="weui-btn weui-btn_primary">立即注册</a>

<script src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdn.bootcss.com/jquery-weui/1.0.1/js/jquery-weui.min.js"></script>


<script type="application/javascript">


    var $userName,  $homeId, $code, $tel, $pwd, $rpwd, $agree;


    $(document).ready(function () {

        console.log("-------------");

        $userName = $('#reg_name');

        $homeId = $('#reg_home_id');
        $code = $('#reg_code');
        $tel = $('#reg_phone');
        $pwd = $('#reg_pwd');
        $rpwd = $('#reg_pwd_r');
        $agree = $('#reg_agree');


    });

    function chkName() {

        if (!$userName.val()) {

            $('.reg_name_item').addClass('weui-cell_warn')
            $userName.attr("value", '不能为空');//填充内容

        } else {

            $('.reg_name_item').removeClass('weui-cell_warn')
        }

    }


    function chkpwd() {

        if ($pwd.val() != $rpwd.val()) {

            $('.reg_pwd_r_item').addClass('weui-cell_warn')
            $pwd.attr("value", '密码错误');//填充内容

        } else {

            $('.reg_pwd_r_item').removeClass('weui-cell_warn')
        }
    }

    function getEntName() {

        var homeId = $homeId.val();

        if (!homeId) {
            alert("请填写单位代码！");
            return;
        }


        $.ajax({
            headers: {
                Accept: "application/json; charset=utf-8",
                cv: '3.6.0'
            },
            type: 'GET',
            url: "/apps/pub/ent/info",
            data: {
                en: homeId,

            },
            success: function (data, status) {

                console.log(data, status);

                if (status === 'success') {

                    if (data.status.indexOf('err_') < 0) {

                        var ent = data.data;

                        alert("您输入的单位代码对应的单位为:【"+ent.entName+"】")



                    } else {

                        if (data.status === 'err_ent_not_exists') {

                            alert("单位不存在");
                            return

                        }


                    }


                }

            }

        })

    }

    function getCkCode() {

        var mobile = $tel.val();

        if (!mobile) {
            alert("请输入手机号码！");
            return;
        }


        $.ajax({
            headers: {
                Accept: "application/json; charset=utf-8",
                cv: '3.6.0'
            },
            type: 'GET',
            url: "/apps/pub/sms/code",
            data: {
                pn: mobile,

            },
            success: function (data, status) {

                console.log(data, status);

                if (status === 'success') {

                    if (data.status.indexOf('err_') < 0) {
                        alert("发送成功，请注意查收")

                    } else {

                        if (data.status === 'err_sms_service') {

                            alert("短信发送失败");
                            return

                        }

                        if (data.status === 'err_sms_phone_number') {

                            alert("无效的手机号码");
                            return

                        }

                        if (data.status === 'err_sms_phone_number_black_list') {

                            alert("该手机为黑名单");
                            return

                        }

                        if (data.status === 'err_user_register_auth_code_exists') {

                            alert("短信已经发送");
                            return

                        }


                    }


                }

            }

        })

    }

    function onClick() {


        var realName = $userName.val();
        var mobile = $tel.val();
        var entNumber = $homeId.val();
        var authCode = $code.val();

        var password = $pwd.val();
        var rpwd = $rpwd.val();
        var agree = $agree.prop("checked");

        if (!agree) {
            alert("请勾选同意协议！");
            return;
        }

        if (!realName) {
            alert("用户名不能为空！");
            $('.reg_name_item').addClass('weui-cell_warn')
            $userName.attr("value", '不能为空');//填充内容
            return;
        }

        if (!mobile) {
            alert("手机号码不能为空！");
            $('.tel_item').addClass('weui-cell_warn')
            $tel.attr("value", '不能为空');//填充内容
            return;
        }

        if (!password) {
            alert("密码不能为空！");
            $('.pwd_item').addClass('weui-cell_warn')
            $pwd.attr("value", '不能为空');//填充内容
            return;
        }

        if (password != rpwd) {
            alert("两次密码不一样！");

            return;
        }


        console.log("-------onClick------", realName, mobile, entNumber, authCode, password, rpwd, agree);

        $.ajax({
            headers: {
                Accept: "application/json; charset=utf-8",
                cv: '3.6.0'
            },
            type: 'POST',
            url: "/apps/pub/register/user",
            data: {
                realName: realName,
                mobile: mobile,
                entNumber: entNumber,
                authCode: authCode,
                password: password
            },
            success: function (data, status) {

                console.log(data, status);

                if (status === 'success') {

                    if (data.status.indexOf('err_') < 0) {
                        alert("恭喜您！提交成功，请登录管理员审核！")
                    } else {

                        if (data.status === 'err_ent_not_exists') {

                            alert("错误！该单位不存在");
                            return

                        }

                        if (data.status === 'err_username_same') {

                            alert("错误！该手机号码已经使用");
                            return

                        }

                        if (data.status === 'err_ent_max_user_limit') {

                            alert("错误！单位最大用户数达到上限");
                            return
                        }

                        if (data.status === "err_user_register_status_pending") {

                            alert("错误！该手机已被注册，管理员正在审核！");
                            return

                        }


                        alert("注册失败！！！")
                    }


                }

            }

        })
    }


</script>


</body>
</html>